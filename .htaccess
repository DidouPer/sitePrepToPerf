# ---------- Redirections canoniques ----------
RewriteEngine On

# 1) Force domaine nu (supprime www) ET HTTPS (couvre http(s)://www.* et http://nu)
RewriteCond %{HTTP_HOST} ^www\.preptoperf\.com$ [NC,OR]
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://preptoperf.com%{REQUEST_URI} [R=301,L]

# ---------- En-têtes SEO & sécurité ----------
# (OVH mutualisé supporte généralement mod_headers)
Header always set X-Content-Type-Options "nosniff"
Header always set X-Frame-Options "SAMEORIGIN"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Permissions-Policy "geolocation=()"
# Déclare explicitement l'indexation
Header set X-Robots-Tag "index, follow"

# HSTS (uniquement si TOUT le site est en HTTPS et stable)
# Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

# ---------- Caching statique ----------
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/css "access plus 7 days"
  ExpiresByType application/javascript "access plus 7 days"
  ExpiresByType text/javascript "access plus 7 days"
  ExpiresByType image/svg+xml "access plus 30 days"
  ExpiresByType image/png "access plus 30 days"
  ExpiresByType image/jpeg "access plus 30 days"
  ExpiresDefault "access plus 1 day"
</IfModule>

# ---------- Compression ----------
# Brotli n'est pas dispo en mutualisé OVH ; DEFLATE suffit
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/css text/javascript application/javascript image/svg+xml
</IfModule>

# ---------- Divers ----------
AddDefaultCharset UTF-8
Options -Indexes

# MIME correct pour webmanifest
AddType application/manifest+json .webmanifest

# Compat' : éviter 404 si quelqu'un demande des noms anciens
RewriteRule ^site\.webmanifest$ assets/site.webmanifest [L]
RewriteRule ^logoPrepToPerf\.png$ assets/logo.png [L]
